<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Vehicles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --bg-main: #2E4F9E;
 --bg-sidebar: rgba(51, 51, 51, 1);
      --bg-topbar: rgba(255,255,255,0.8);
      --text-color: #1f2937;
      --card-bg: rgba(255,255,255,0.3);
    }
    body.dark {
      --bg-main: #1e293b;
 --bg-sidebar: rgba(51, 51, 51, 1);
      --bg-topbar: rgba(30,41,59,0.95);
      --text-color: #f8fafc;
      --card-bg: rgba(51,65,85,0.5);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      min-height: 100vh;
      background: var(--bg-main);
      transition: 0.3s;
    }
    /* Sidebar */
    .sidebar {
      width: 240px;
      background: var(--bg-sidebar);
      color: #fff;
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(10px);
    }
    .sidebar h2 {
      text-align: center;
      padding: 18px 10px;
      font-size: 18px;
      background: rgba(46, 110, 76, 1);
    }
    .sidebar nav { display: flex; flex-direction: column; margin-top: 10px; }
    .nav-link {
      padding: 12px 20px;
      font-size: 15px;
      color: #cbd5e0;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
      border-left: 4px solid transparent;
      transition: all 0.3s;
    }
    .nav-link:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
      border-left: 4px solid #60a5fa;
      padding-left: 26px;
    }
    .nav-link.active {
      background: #2563eb;
      color: #fff;
      border-left: 4px solid #3b82f6;
    }
    /* Main */
    .main { flex-grow: 1; display: flex; flex-direction: column; }
    .topbar {
      background: var(--bg-topbar);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(10
      px);
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .topbar h1 { font-size: 20px; color: var(--text-color); }
    .topbar .actions { display: flex; gap: 10px; }
    .topbar button {
      border: none;
      border-radius: 6px;
      cursor: pointer;
      padding: 10px;
    }
    .dark-mode-toggle { background: #1f2937; color: #fff; }
    .logout-btn { background: #dc3545; color: #fff; font-weight: bold; }
    /* Content */
    .content { padding: 30px 40px; flex-grow: 1; overflow-y: auto; }
    .card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    form input, form button {
      padding: 10px;
      margin: 6px 0;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    form button[type="submit"] { background: #2563eb; color: #fff; }
    form button[type="submit"]:hover { background: #1d4ed8; }
    #searchInput {
      padding: 10px;
      margin-bottom: 20px;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #d3d0d0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    th { background: rgba(255,255,255,0.2); }
    .delete-vehicle {
      background: #e53935;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    .delete-vehicle:hover { background: #b71c1c; }
    .vehicle-photo {
      width: 60px;
      height: 40px;
      object-fit: cover;
      border-radius: 6px;
    }

h2 a {
  text-decoration: none; /* remove underline */
  color: inherit;        /* use same color as h2 */
  display: block;        /* make the whole h2 area clickable */
}
h2 a:hover {
  color: #60a5fa; /* optional hover color */
}

/* --- Mobile sidebar toggle styles --- */
.menu-toggle {
  background: none;
  border: none;
  color: var(--text-color);
  font-size: 22px;
  cursor: pointer;
  display: none; /* hidden on desktop */
}

@media (max-width: 768px) {
  /* Ensure no horizontal overflow */
  html, body {
    width: 100%;
    overflow-x: hidden;
  }

  /* Sidebar responsive */
  .menu-toggle {
    display: block;
  }

  .sidebar {
    position: fixed;
    left: -250px;
    top: 0;
    width: 220px;
    height: 100%;
    background: var(--bg-sidebar);
    transition: left 0.3s ease;
    z-index: 1000;
  }

  .sidebar.show {
    left: 0;
  }

  /* Topbar adjustment */
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    flex-wrap: wrap;
  }

  .topbar h1 {
    font-size: 18px;
  }

  .logout-btn {
    padding: 8px 12px;
    font-size: 14px;
  }

  /* Content + Cards full width */
  .content {
    padding: 12px;
  }

  .card {
    width: 100%;
    padding: 14px;
    margin-bottom: 16px;
  }

  /* Form fields */
  form {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  form input, form button {
    width: 100%;
    font-size: 14px;
    padding: 8px;
  }

  #vehiclePhoto {
    font-size: 13px;
  }

  /* Make table fully scrollable on small screen */
  .card table {
    display: block;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  th, td {
    padding: 8px;
    font-size: 13px;
    text-align: left;
  }

  /* Prevent elements from going off-screen */
  table, th, td, input, button {
    max-width: 100%;
    word-wrap: break-word;
  }

  /* Ensure Add Vehicle title fits */
  h3 {
    font-size: 16px;
  }

  /* Prevent overflow when sidebar open */
  body.sidebar-open {
    overflow: hidden;
  }
}


/* Global fix to prevent mobile overflow */
html, body {
  max-width: 100%;
  overflow-x: hidden;
}



  </style>
</head>
<body>
  <div class="sidebar">
    <h2><a href="admin_dashboard.html">CTU Admin</a></h2>

    <nav>
      <a href="vehicle-reservations.html" class="nav-link"><i class="fas fa-car"></i><span>Vehicle Reservations</span></a>
      <a href="manage-vehicles.html" class="nav-link active"><i class="fas fa-tools"></i><span>Manage Vehicles</span></a>
      <a href="registered-drivers.html" class="nav-link"><i class="fas fa-id-badge"></i><span>Registered Drivers</span></a>
      <a href="confirmed-reservations.html" class="nav-link"><i class="fas fa-check-circle"></i><span>Confirmed Reservations</span></a>
      <a href="complete.html" class="nav-link"><i class="fas fa-file-alt"></i><span>Complete</span></a>
      <a href="ontrip.html" class="nav-link"><i class="fas fa-route"></i><span>On Trip</span></a>
       <a href="mapview.html" class="nav-link"><i class="fas fa-map"></i><span class="link-text">Map View</span></a>
      <a href="change-password.html" class="nav-link"><i class="fas fa-key"></i><span>Change Password</span></a>
    </nav>
  </div>

  <div class="main">
   <div class="topbar">
  <div style="display: flex; align-items: center; gap: 10px;">
    <button id="menuToggle" class="menu-toggle">
      <i class="fas fa-bars"></i>
    </button>
    <h1>Manage Vehicles</h1>
  </div>
  <div class="actions">
    <button id="logout" class="logout-btn">Logout</button>
  </div>
</div>


    <div class="content">
      <div class="card">
        <h3>Add New Vehicle</h3>
        <form id="addVehicleForm">
          <input type="text" id="vehicleName" placeholder="Vehicle Name" required>
          <input type="text" id="vehiclePlate" placeholder="Plate Number" required>
          <input type="number" id="vehicleSeats" placeholder="Number of Seats" required>
          <input type="file" id="vehiclePhoto" accept="image/*" required>
          <button type="submit">Add Vehicle</button>
        </form>
      </div>

      <input type="text" id="searchInput" placeholder="Search by name, plate or seats..." class="card">

      <div class="card">
        <table>
          <thead>
            <tr><th>Photo</th><th>Name</th><th>Plate</th><th>Seats</th><th>Status</th><th>Action</th></tr>
          </thead>
          <tbody id="vehicleList"><tr><td colspan="6">Loading...</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getDatabase, ref, onValue, push, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA1Guf5lPfPsgtpBTm4MY3r3N9a8wfQumY",
      authDomain: "vehicle-management-syste-8f7fe.firebaseapp.com",
      databaseURL: "https://vehicle-management-syste-8f7fe-default-rtdb.firebaseio.com",
      projectId: "vehicle-management-syste-8f7fe",
      storageBucket: "vehicle-management-syste-8f7fe.appspot.com",
      messagingSenderId: "423136689247",
      appId: "1:423136689247:web:47dc93d0a171f06f096fea",
      measurementId: "G-PF0808T11H"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const vehiclesRef = ref(db, "vehicles");

    const vehicleList = document.getElementById("vehicleList");
    const form = document.getElementById("addVehicleForm");
    const nameInput = document.getElementById("vehicleName");
    const plateInput = document.getElementById("vehiclePlate");
    const seatsInput = document.getElementById("vehicleSeats");
    const photoInput = document.getElementById("vehiclePhoto");
    const searchInput = document.getElementById("searchInput");

    let allVehicles = {};

    // Auth check
    onAuthStateChanged(auth, user => {
      if (!user) {
        window.location.href = "admin-login.html";
      } else {
        onValue(vehiclesRef, snap => {
          allVehicles = snap.val() || {};
          filterAndRenderList();
        });
      }
    });

    // Add new vehicle
    form.addEventListener("submit", e => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const plate = plateInput.value.trim().toUpperCase();
      const seats = seatsInput.value.trim();
      const file = photoInput.files[0];

      if (!name || !plate || !seats || !file) return alert("Fill all fields including photo.");

      const reader = new FileReader();
      reader.onloadend = () => {
        const base64Image = reader.result;

        onValue(vehiclesRef, snap => {
          const data = snap.val() || {};
          if (Object.values(data).some(v => v.plate.toUpperCase() === plate)) {
            alert("Plate already exists.");
          } else {
            push(vehiclesRef, { name, plate, seats, photo: base64Image, status: "Available" })
              .then(() => form.reset());
          }
        }, { onlyOnce: true });
      };
      reader.readAsDataURL(file);
    });

    // Render list
    function filterAndRenderList() {
      const q = searchInput.value.trim().toLowerCase();
      vehicleList.innerHTML = "";

      const entries = Object.entries(allVehicles).filter(([, v]) => {
        const name = (v.name || "").toLowerCase();
        const plate = (v.plate || "").toLowerCase();
        const seats = v.seats ? v.seats.toString() : "";
        return name.includes(q) || plate.includes(q) || seats.includes(q);
      });

      if (!entries.length) {
        vehicleList.innerHTML = "<tr><td colspan='6'>No vehicles found.</td></tr>";
        return;
      }

      entries.forEach(([id, v]) => {
        const row = document.createElement("tr");
        row.innerHTML =
          `<td>${v.photo ? `<img src="${v.photo}" class="vehicle-photo">` : "N/A"}</td>
           <td>${v.name || "N/A"}</td>
           <td>${v.plate || "N/A"}</td>
           <td>${v.seats || "N/A"}</td>
           <td>${v.status || "Available"}</td>
           <td><button class="delete-vehicle">Delete</button></td>`;

        row.querySelector(".delete-vehicle").onclick = () => {
          if (confirm("Delete " + (v.name || "this vehicle") + "?")) {
            remove(ref(db, "vehicles/" + id));
          }
        };
        vehicleList.appendChild(row);
      });
    }

    searchInput.addEventListener("input", filterAndRenderList);

    document.getElementById("logout").onclick = () => {
      signOut(auth).then(() => window.location.href = "admin-login.html");
    };

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
    }

// Sidebar toggle for mobile
const sidebar = document.querySelector('.sidebar');
const menuToggle = document.getElementById('menuToggle');
let sidebarVisible = false;

menuToggle.addEventListener('click', (e) => {
  e.stopPropagation();
  sidebarVisible = !sidebarVisible;
  sidebar.classList.toggle('show', sidebarVisible);
});

// Auto-close sidebar when clicking outside or on a link (mobile)
document.addEventListener('click', (e) => {
  if (window.innerWidth <= 768 && sidebarVisible) {
    if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
      sidebarVisible = false;
      sidebar.classList.remove('show');
    }
  }
});

document.querySelectorAll('.nav-link').forEach(link => {
  link.addEventListener('click', () => {
    if (window.innerWidth <= 768) {
      sidebarVisible = false;
      sidebar.classList.remove('show');
    }
  });
});




  </script>
</body>
</html>
