<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ongoing Trips</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --bg-main: #6d87c7;
    --bg-sidebar: rgba(51, 51, 51, 1);
      --bg-topbar: rgba(255, 255, 255, 0.8);
      --text-color: #1f2937;
      --card-bg: rgba(255, 255, 255, 0.3);
    }
    body.dark {
      --bg-main: #6d87c7;
 --bg-sidebar: rgba(51, 51, 51, 1);
      --bg-topbar: rgba(30,41,59,0.95);
      --text-color: #f8fafc;
      --card-bg: rgba(51,65,85,0.5);
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Segoe UI',sans-serif;display:flex;min-height:100vh;background-color: var(--bg-main);transition:0.3s;}

    /* Sidebar */
    .sidebar{
      width:240px;background:var(--bg-sidebar);color:#fff;
      display:flex;flex-direction:column;backdrop-filter:blur(10px);
    }
    .sidebar h2{text-align:center;padding:18px 10px;font-size:18px;background:rgba(46, 110, 76, 1);}
    .sidebar nav{display:flex;flex-direction:column;margin-top:10px;}
    .nav-link{
      padding:12px 20px;font-size:15px;color:#cbd5e0;text-decoration:none;
      display:flex;align-items:center;gap:10px;border-left:4px solid transparent;
      transition:all 0.3s;
    }
    .nav-link:hover{
      background:rgba(255,255,255,0.1);color:#fff;border-left:4px solid #60a5fa;padding-left:26px;
    }
    .nav-link.active{background:#2563eb;color:#fff;border-left:4px solid #3b82f6;}

    /* Main content */
    .main{flex-grow:1;display:flex;flex-direction:column;}
    .topbar{
      background:var(--bg-topbar);padding:16px 24px;
      display:flex;justify-content:space-between;align-items:center;
      backdrop-filter:blur(10px);box-shadow:0 1px 4px rgba(0,0,0,0.1);
    }
    .topbar h1{font-size:20px;color:var(--text-color);}
    .topbar .actions{display:flex;align-items:center;gap:10px;}
    .topbar button{border:none;border-radius:6px;cursor:pointer;padding:10px;}
    .topbar .dark-mode-toggle{background:#1f2937;color:#fff;}
    .topbar .logout-btn{background:#dc3545;color:#fff;font-weight:bold;}

    /* Content */
    .content{padding:30px 40px;flex-grow:1;overflow-y:auto;}
    h2.page-title{text-align:center;margin-bottom:20px;color: var(--text-color);}

    .trip-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
    }
    .trip {
      background-color: #fff;padding:20px;border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.2s ease-in-out;
    }
    .trip:hover{transform: translateY(-4px);}
    .trip p{margin:6px 0;font-size:0.95rem;}
    .trip p strong{display:inline-block;width:140px;font-weight:600;}
    .buttons{text-align:center;margin-top:30px;}
    button.action-btn{padding:10px 20px;margin:0 10px;background-color:#2c3e50;color:white;border:none;border-radius:6px;cursor:pointer;}
    button.action-btn:hover{background-color:#1a252f;}
    .no-trips{text-align:center;font-size:1.1rem;color:#777;}
    @media (max-width: 480px){
      .trip p strong{width:auto;display:block;margin-bottom:3px;}
    }

h2 a {
  text-decoration: none; /* remove underline */
  color: inherit;        /* use same color as h2 */
  display: block;        /* make the whole h2 area clickable */
}
h2 a:hover {
  color: #60a5fa; /* optional hover color */
}


/* --- Mobile sidebar toggle styles --- */
.menu-toggle {
  background: none;
  border: none;
  color: var(--text-color);
  font-size: 22px;
  cursor: pointer;
  display: none; /* hidden on desktop */
}

@media (max-width: 768px) {
  .content {
    padding: 20px;
  }
  .topbar h1 {
    font-size: 18px;
  }
  .logout-btn {
    padding: 8px 12px;
    font-size: 14px;
  }
  .trip {
    padding: 15px;
  }
  .trip-container {
    grid-template-columns: 1fr; /* Single column for mobile */
  }
}
/* Mobile sidebar hide + animation */
@media (max-width: 768px) {
  .sidebar {
    position: fixed;
    left: -250px;
    top: 0;
    height: 100%;
    z-index: 1000;
    transition: left 0.3s ease;
  }

  .sidebar.show {
    left: 0;
  }

  /* Show hamburger */
  .menu-toggle {
    display: inline-block;
  }

  /* Main content pushes slightly */
  .main {
    width: 100%;
  }
}






  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
<h2><a href="admin_dashboard.html">CTU Admin</a></h2>

    <nav>
      <a href="vehicle-reservations.html" class="nav-link"><i class="fas fa-car"></i><span class="link-text">Vehicle Reservations</span></a>
      <a href="manage-vehicles.html" class="nav-link"><i class="fas fa-tools"></i><span class="link-text">Manage Vehicles</span></a>
      <a href="registered-drivers.html" class="nav-link"><i class="fas fa-id-badge"></i><span class="link-text">Registered Drivers</span></a>
      <a href="confirmed-reservations.html" class="nav-link"><i class="fas fa-check-circle"></i><span class="link-text">Confirmed Reservations</span></a>
      <a href="complete.html" class="nav-link"><i class="fas fa-file-alt"></i><span class="link-text">Completed Trips</span></a>
      <a href="ontrip.html" class="nav-link active"><i class="fas fa-route"></i><span class="link-text">Ongoing Trips</span></a>
       <a href="mapview.html" class="nav-link"><i class="fas fa-map"></i><span class="link-text">Map View</span></a>
      <a href="change-password.html" class="nav-link"><i class="fas fa-key"></i><span class="link-text">Change Password</span></a>
    </nav>
  </div>

<div class="main">
  <div class="topbar">
 <div style="display: flex; align-items: center; gap: 10px;">
  <button id="menuToggle" class="menu-toggle">
    <i class="fas fa-bars"></i>
  </button>
  <h1>Ongoing Trips</h1>
</div>
<div>
  <button id="logout" class="logout-btn">Logout</button>
</div>
</div> <!-- âœ… properly closes .topbar -->

<div class="content">
  <h2 class="page-title">Ongoing Trip List</h2>
  <div class="trip-container" id="tripList"></div>
  <div class="buttons"></div>
</div>





 



  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA1Guf5lPfPsgtpBTm4MY3r3N9a8wfQumY",
      authDomain: "vehicle-management-syste-8f7fe.firebaseapp.com",
      databaseURL: "https://vehicle-management-syste-8f7fe-default-rtdb.firebaseio.com",
      projectId: "vehicle-management-syste-8f7fe",
      storageBucket: "vehicle-management-syste-8f7fe.firebasestorage.app",
      messagingSenderId: "423136689247",
      appId: "1:423136689247:web:47dc93d0a171f06f096fea",
      measurementId: "G-PF0808T11H"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const tripList = document.getElementById("tripList");

    onAuthStateChanged(auth, user => {
      if(!user){
        alert("Please login first.");
        window.location.href = "admin-login.html";
        return;
      }
      const reservationsRef = ref(db, "reservations");
      onValue(reservationsRef, snapshot => {
        tripList.innerHTML = "";
        let found = false;
        snapshot.forEach(child => {
          const data = child.val();
          if(data.status === "ONTRIP"){
            found = true;
            const div = document.createElement("div");
            div.className = "trip";
            div.innerHTML = `
              <p><strong>Name:</strong> ${data.name || "N/A"}</p>
              <p><strong>Destination:</strong> ${data.destination || "N/A"}</p>
              <p><strong>Vehicle:</strong> ${data.vehicle || "N/A"}</p>
              <p><strong>Plate:</strong> ${data.plate || "N/A"}</p>
              <p><strong>Date:</strong> ${data.date || "N/A"}</p>
              <p><strong>Time Slot:</strong> ${data.timeSlot || "N/A"}</p>
              <p><strong>Driver:</strong> ${data.driver || "N/A"}</p>
             <p><strong>Start Time:</strong> ${formatTime(data.tripStartTime)}</p>

              <p><strong>Status:</strong> <span style="color: #f39c12;">ONGOING</span></p>
            `;
            tripList.appendChild(div);
          }
        });
        if(!found) tripList.innerHTML = "<p class='no-trips'>No ongoing trips found.</p>";
      });
    });

    document.getElementById("logout").onclick = () => signOut(auth).then(()=> window.location.href="driver-login.html");
    function toggleDarkMode(){ document.body.classList.toggle('dark'); }
  // Sidebar toggle for mobile
const sidebar = document.querySelector('.sidebar');
const menuToggle = document.getElementById('menuToggle');
let sidebarVisible = false;

menuToggle.addEventListener('click', (e) => {
  e.stopPropagation();
  sidebarVisible = !sidebarVisible;
  sidebar.classList.toggle('show', sidebarVisible);
});

document.addEventListener('click', (e) => {
  if (window.innerWidth <= 768 && sidebarVisible) {
    if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
      sidebarVisible = false;
      sidebar.classList.remove('show');
    }
  }
});

document.querySelectorAll('.nav-link').forEach(link => {
  link.addEventListener('click', () => {
    if (window.innerWidth <= 768) {
      sidebarVisible = false;
      sidebar.classList.remove('show');
    }
  });
});


function formatTime(isoString) {
  if (!isoString) return "N/A";
  const date = new Date(isoString);

  const options = {
    year: "numeric",
    month: "long",
    day: "numeric",
    hour: "numeric",
    minute: "numeric",
    hour12: true
  };

  return date.toLocaleString("en-US", options);
}



  </script>
</body>
</html>
